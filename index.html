<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Medição de Válvulas do Scania-550</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  line-height: 1.6;
  background-color: #d0f0c0;
}
h1, h2, h3 {
  color: #333;
  margin-top: 20px;
  margin-bottom: 10px;
}
h1 {
  font-size: 24px;
  text-align: center;
  border-bottom: 2px solid #333;
  padding-bottom: 10px;
}
h2 {
  font-size: 20px;
  margin-top: 30px;
  margin-bottom: 15px;
  text-align: center;
}
h3 {
  font-size: 16px;
  text-align: center;
  margin: 15px 0;
}
.valve-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-bottom: 20px;
}
.valve-section {
  border: 1px solid #ddd;
  padding: 15px;
  margin-bottom: 20px;
  width: 32%;
  box-sizing: border-box;
  background-color: #ffffff;
}
.valve-type {
  font-weight: bold;
  margin-top: 10px;
  text-align: center;
  padding: 5px;
  border-radius: 4px;
}
.exaustao {
  background-color: #ffb84d;
  color: #333;
}
.admissao {
  background-color: #2e8b57;
  color: #fff;
}
.measurement {
  text-align: center;
  margin: 10px 0;
  font-size: 18px;
}
input[type="text"], input[type="date"], textarea {
  width: 120px;
  padding: 8px;
  text-align: center;
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 4px;
}
textarea {
  width: 100%;
  height: 100px;
  padding: 10px;
  text-align: left;
  resize: vertical;
}
.info-table {
  width: 100%;
  margin-bottom: 20px;
}
.info-table td {
  padding: 5px 0;
  text-align: left;
}
.signature {
  margin-top: 50px;
  border-top: 1px solid #000;
  width: 320px;
  padding-top: 5px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  position: relative;
}
/* input da assinatura */
#assinatura {
  position: absolute;
  top: -36px;
  left: 0;
  width: 320px;
  border: none;
  font-size: 28px;
  text-align: center;
  background: transparent;
  outline: none;
  font-family: 'Brush Script MT', cursive, Arial, sans-serif;
  color: #000;
}
#assinatura::placeholder {
  color: #999;
}
.warning {
  background-color: #fff3cd;
  padding: 10px;
  border-left: 4px solid #ffc107;
  margin: 15px 0;
  text-align: center;
}
.obs {
  margin-top: 30px;
  font-style: italic;
}
.button-container {
  margin-top: 20px;
  text-align: center;
}
button {
  background-color: #2e8b57;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 0 10px;
  font-size: 16px;
  border-radius: 4px;
  cursor: pointer;
}
button.clear-btn {
  background-color: #ff6b6b;
}
@media (max-width: 900px) {
  .valve-section {
    width: 100%;
  }
}
</style>
</head>
<body>
<h1>MEDIÇÃO DAS VÁLVULAS DO SCANIA-550</h1>

<table class="info-table">
<tr>
  <td><strong>MECÂNICO:</strong> <input type="text" id="mecanico" style="width: 200px;"></td>
  <td><strong>DATA:</strong> <input type="date" id="data"></td>
</tr>
<tr>
  <td><strong>USINA:</strong> <input type="text" id="usina" style="width: 200px;"></td>
  <td><strong>HORÍMETRO:</strong> <input type="text" id="horimetro"></td>
</tr>
<tr>
  <td><strong>SÉRIE:</strong> <input type="text" id="serie" style="width: 200px;"></td>
  <td><strong>OS:</strong> <input type="text" id="os"></td>
</tr>
<tr>
  <td><strong>UGD-</strong> <input type="text" id="ugd" style="width: 60px;" placeholder=""></td>
  <td></td>
</tr>
</table>

<div class="warning">
  <h3>MEDIÇÕES ACEITÁVEIS: 64,00mm a <span style="font-weight:bold; color:red;">67,50mm</span></h3>
  <h3>ACIMA DE <span style="font-weight:bold; color:red;">67,50mm</span> DEVE SER CONSIDERADA SUBSTITUIÇÃO</h3>
</div>

<div class="valve-container">
  <!-- Cilindro 1 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 1° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao1_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao1_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao1_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao1_2" placeholder="mm"></div>
  </div>

  <!-- Cilindro 2 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 2° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao2_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao2_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao2_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao2_2" placeholder="mm"></div>
  </div>

  <!-- Cilindro 3 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 3° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao3_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao3_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao3_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao3_2" placeholder="mm"></div>
  </div>
</div>

<div class="valve-container">
  <!-- Cilindro 4 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 4° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao4_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao4_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao4_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao4_2" placeholder="mm"></div>
  </div>

  <!-- Cilindro 5 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 5° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao5_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao5_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao5_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao5_2" placeholder="mm"></div>
  </div>

  <!-- Cilindro 6 -->
  <div class="valve-section">
    <h2>MEDIDAS DO 6° CILINDRO</h2>
    <div class="valve-type exaustao">VÁLVULAS EXAUSTÃO</div>
    <div class="measurement"><input type="text" id="exaustao6_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="exaustao6_2" placeholder="mm"></div>
    <div class="valve-type admissao">VÁLVULAS ADMISSÃO</div>
    <div class="measurement"><input type="text" id="admissao6_1" placeholder="mm"></div>
    <div class="measurement"><input type="text" id="admissao6_2" placeholder="mm"></div>
  </div>
</div>

<div class="obs">
  <p><strong>OBSERVAÇÕES:</strong></p>
  <textarea id="observacoes"></textarea>
</div>

<div class="button-container">
  <button id="generatePdf">Gerar PDF</button>
  <button id="clearBtn" class="clear-btn">Limpar</button>
</div>

<div class="signature">
  ASSINATURA DO MECÂNICO: 
  <input type="text" id="assinatura" placeholder="Digite seu nome aqui" />
</div>

<script>
const { jsPDF } = window.jspdf;

function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
  const words = text.split(' ');
  let line = '';
  let linesCount = 0;

  for (let n = 0; n < words.length; n++) {
    const testLine = line + words[n] + ' ';
    const metrics = ctx.measureText(testLine);
    const testWidth = metrics.width;
    if (testWidth > maxWidth && n > 0) {
      ctx.fillText(line, x, y + linesCount * lineHeight);
      line = words[n] + ' ';
      linesCount++;
    } else {
      line = testLine;
    }
  }
  ctx.fillText(line, x, y + linesCount * lineHeight);
}

// Função para padronizar valor conforme regra:
// - Se valor tem 3 dígitos e só números, interpretar como dois primeiros dígitos + vírgula + último
// - Se valor tem ponto, substituir por vírgula
// - Se valor tem vírgula, manter
// - Caso contrário, manter igual
function padronizarValor(valor) {
  valor = valor.trim();
  // só dígitos, sem vírgula ou ponto, e tamanho 3, ex: "652"
  if (/^\d{3}$/.test(valor)) {
    // insere vírgula antes do último dígito
    return valor.slice(0, 2) + ',' + valor.slice(2);
  }
  // substituir ponto por vírgula
  if (valor.includes('.')) {
    return valor.replace('.', ',');
  }
  // se já tem vírgula ou outros formatos, retorna igual
  return valor;
}

document.getElementById('generatePdf').addEventListener('click', async function() {
  const img = new Image();
  img.src = 'https://raw.githubusercontent.com/gabrielsenna97/Medi-o-de-V-lvulas/refs/heads/main/FORM.194_MEDI%C3%87%C3%83O%20DAS%20VALVULAS_UTE550_REV0_O%26M%20(2).jpg';
  img.crossOrigin = 'Anonymous';

  await new Promise((resolve) => { img.onload = resolve; });

  const canvas = document.createElement('canvas');
  canvas.width = img.width;
  canvas.height = img.height;
  const ctx = canvas.getContext('2d');

  ctx.drawImage(img, 0, 0);

  ctx.font = 'bold 18px Arial';
  ctx.fillStyle = '#000000';
  ctx.textAlign = 'left';

  ctx.fillText(document.getElementById('mecanico').value || '', 208, 176);
  ctx.fillText(document.getElementById('usina').value || '', 165, 204);
  ctx.fillText(document.getElementById('serie').value || '', 165, 231);

  const ugdVal = document.getElementById('ugd').value;
  ctx.fillText(ugdVal ? `UGD- ${ugdVal}` : '', 229, 204);

  ctx.fillText(document.getElementById('os').value || '', 292, 262);

  const dataValue = document.getElementById('data').value;
  if (dataValue) {
    const dataFormatada = new Date(dataValue).toLocaleDateString('pt-BR');
    ctx.fillText(dataFormatada, 888, 204);
  }

  ctx.fillText(document.getElementById('horimetro').value || '', 798, 231);

  const limiteMaximo = 67.50;

  const campos = [
    ['exaustao1_1', 105, 616], ['exaustao1_2', 105, 576], ['admissao1_1', 345, 628], ['admissao1_2', 345, 589],
    ['exaustao2_1', 450, 1064], ['exaustao2_2', 450, 1024], ['admissao2_1', 689, 1075], ['admissao2_2', 689, 1038],
    ['exaustao3_1', 792, 617], ['exaustao3_2', 792, 576], ['admissao3_1', 1032, 628], ['admissao3_2', 1032, 589],
    ['exaustao4_1', 793, 1064], ['exaustao4_2', 793, 1024], ['admissao4_1', 1033, 1075], ['admissao4_2', 1033, 1038],
    ['exaustao5_1', 450, 617], ['exaustao5_2', 450, 576], ['admissao5_1', 689, 628], ['admissao5_2', 689, 589],
    ['exaustao6_1', 105, 1064], ['exaustao6_2', 105, 1024], ['admissao6_1', 345, 1075], ['admissao6_2', 345, 1038]
  ];

  campos.forEach(([id, x, y]) => {
    let valRaw = document.getElementById(id)?.value || '';
    let val = padronizarValor(valRaw);
    // substituir vírgula por ponto para parsear número
    let valNum = parseFloat(val.replace(',', '.'));

    if (!isNaN(valNum)) {
      ctx.font = 'bold 18px Arial'; // sempre negrito
      ctx.fillStyle = valNum >= limiteMaximo ? 'red' : 'black'; // vermelho se >= 67.5, preto se menor
      ctx.fillText(val, x, y);
    } else {
      ctx.font = '18px Arial';
      ctx.fillStyle = 'black';
      ctx.fillText(valRaw, x, y);
    }
  });

  const observacoes = document.getElementById('observacoes').value;
  wrapText(ctx, observacoes, 183, 1200, 900, 24);

  ctx.font = 'italic 32px Brush Script MT, cursive, Arial';
  ctx.fillText(document.getElementById('assinatura').value || '', 750, 1320);

  const pdf = new jsPDF({
    unit: 'mm',
    format: 'a4'
  });

  const imgData = canvas.toDataURL('image/png');

  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();

  const scale = Math.min(pdfWidth / canvas.width, pdfHeight / canvas.height);

  const imgWidth = canvas.width * scale;
  const imgHeight = canvas.height * scale;

  const x = (pdfWidth - imgWidth) / 2;
  const y = 10;

  pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);

  pdf.save('medicao-valvulas.pdf');
});

document.getElementById('clearBtn').addEventListener('click', function() {
  const inputs = document.querySelectorAll('input[type="text"], input[type="date"], textarea');
  inputs.forEach(input => input.value = '');
});

// Aplicar negrito sempre e cor conforme valor (menor: preto, maior ou igual: vermelho)
const camposMedicao = [
  'exaustao1_1', 'exaustao1_2', 'admissao1_1', 'admissao1_2',
  'exaustao2_1', 'exaustao2_2', 'admissao2_1', 'admissao2_2',
  'exaustao3_1', 'exaustao3_2', 'admissao3_1', 'admissao3_2',
  'exaustao4_1', 'exaustao4_2', 'admissao4_1', 'admissao4_2',
  'exaustao5_1', 'exaustao5_2', 'admissao5_1', 'admissao5_2',
  'exaustao6_1', 'exaustao6_2', 'admissao6_1', 'admissao6_2'
];

function verificarValorEColorir(input) {
  let valRaw = input.value.trim();
  let val = padronizarValor(valRaw);
  let num = parseFloat(val.replace(',', '.'));
  if (!isNaN(num)) {
    input.style.fontWeight = 'bold'; // sempre negrito
    if (num >= 67.50) {
      input.style.color = 'red';
    } else {
      input.style.color = 'black';
    }
  } else {
    input.style.fontWeight = '';
    input.style.color = '';
  }
}

camposMedicao.forEach(id => {
  const input = document.getElementById(id);
  if (input) {
    verificarValorEColorir(input);
    input.addEventListener('input', () => verificarValorEColorir(input));
  }
});
</script>

</body>
</html>



