<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medição de Válvulas do Scania-550</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h2>Medição de Válvulas</h2>

  <form id="formulario">
    <label for="motorista">Motorista:</label>
    <input type="text" id="motorista" /><br />

    <label for="placa">Placa:</label>
    <input type="text" id="placa" /><br />

    <label for="data">Data:</label>
    <input type="date" id="data" /><br />

    <!-- Campos de válvulas (exemplo) -->
    <label for="valvula1">Válvula 1:</label>
    <input type="text" id="valvula1" /><br />

    <label for="valvula2">Válvula 2:</label>
    <input type="text" id="valvula2" /><br />

    <!-- Campo de observações -->
    <label for="observacoes">Observações:</label><br />
    <textarea id="observacoes" rows="6" cols="50"></textarea><br />

    <button type="button" id="generateBtn">Gerar PDF</button>
    <button type="button" id="clearBtn">Limpar</button>
  </form>

  <script>
    const { jsPDF } = window.jspdf;

    document.getElementById('generateBtn').addEventListener('click', async function () {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();
      img.src = 'background.jpg';

      await new Promise(resolve => {
        img.onload = () => {
          canvas.width = 1180;
          canvas.height = 1683;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          // Fonte e cor padrão
          ctx.font = 'bold 12px Arial';
          ctx.fillStyle = '#000000';

          // Lista de campos com posições X e Y
          const campos = [
            { id: 'motorista', x: 183, y: 150 },
            { id: 'placa', x: 183, y: 190 },
            { id: 'data', x: 183, y: 230 },
            { id: 'valvula1', x: 200, y: 300 },
            { id: 'valvula2', x: 200, y: 340 },
            // ... continue com os outros campos e coordenadas que você usou
          ];

          campos.forEach(campo => {
            const valor = document.getElementById(campo.id).value || '';
            ctx.fillText(valor, campo.x, campo.y);
          });

          // Quebrar texto de observações automaticamente
          const textoObs = document.getElementById('observacoes').value;
          desenharTextoQuebrado(ctx, textoObs, 183, 1025, 800, 24);

          const imgData = canvas.toDataURL('image/jpeg', 1.0);
          const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'px',
            format: [1180, 1683]
          });

          pdf.addImage(imgData, 'JPEG', 0, 0, 1180, 1683);
          pdf.save('medicao-valvulas.pdf');
          resolve();
        };
      });
    });

    // Função para desenhar texto quebrado automaticamente
    function desenharTextoQuebrado(ctx, texto, x, y, maxWidth, lineHeight) {
      const palavras = texto.split(' ');
      let linha = '';
      for (let i = 0; i < palavras.length; i++) {
        const testeLinha = linha + palavras[i] + ' ';
        const largura = ctx.measureText(testeLinha).width;
        if (largura > maxWidth && i > 0) {
          ctx.fillText(linha, x, y);
          linha = palavras[i] + ' ';
          y += lineHeight;
        } else {
          linha = testeLinha;
        }
      }
      ctx.fillText(linha, x, y);
    }

    document.getElementById('clearBtn').addEventListener('click', function () {
      const inputs = document.querySelectorAll('input[type="text"], input[type="date"], textarea');
      inputs.forEach(input => input.value = '');
    });
  </script>
</body>
</html>
